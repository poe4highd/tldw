# YouTube视频分析器

一个基于Flask的YouTube视频分析工具，可以自动下载音频、生成字幕、AI分析内容并生成交互式简报。

## 功能特性

- 🎥 YouTube音频下载
- 🎤 自动语音转文字（Whisper）
- 🤖 AI内容分析和总结（GPT-4）
- 📄 生成交互式HTML简报
- 💾 SQLite数据库存储
- 🔄 断点恢复（检查点系统）

## 简报页面功能

生成的简报页面包含以下功能：

### 布局结构
- **顶部区域**：嵌入式YouTube播放器 + 内容摘要
- **左侧面板**：关键要点（带时间戳跳转）
- **右侧面板**：完整字幕列表

### 字幕交互功能
- **点击跳转**：点击任意字幕行跳转到对应时间点
- **智能播放**：点击跳转时保持原有播放/暂停状态
- **同步高亮**：视频播放时自动高亮当前字幕
- **分组高亮**：鼠标悬停时同一时间戳的字幕会一起高亮
- **自动滚动**：播放时字幕列表自动滚动到当前位置

### 快捷键
- `空格键`：播放/暂停
- `← →`：快退/快进10秒

## 快速开始

### 1. 环境要求

- Python 3.8+
- FFmpeg（用于音频处理）

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 配置环境变量

复制 `.env` 文件并配置：

```bash
OPENAI_API_KEY=your_openai_api_key_here
FLASK_ENV=development
FLASK_DEBUG=True
```

### 4. 运行应用

```bash
python app.py
```

访问 http://localhost:5123

## 项目结构

```
tldw/
├── app.py              # Flask主应用
├── database.py         # 数据库操作
├── video_processor.py  # 视频处理核心逻辑
├── requirements.txt    # Python依赖
├── .env               # 环境变量配置
├── templates/         # HTML模板
│   └── index.html
├── downloads/         # 音频文件存储
├── transcripts/       # 字幕文件存储
└── reports/          # HTML简报存储
```

## 处理流程

```
┌─────────────────────────────────────────────────────────────┐
│                    YouTube视频分析流程                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1️⃣ 下载音频                                                │
│     └─→ yt-dlp 下载YouTube音频 → MP3文件                    │
│         ✅ 检查点: download_completed                        │
│                                                             │
│  2️⃣ 语音转录                                                │
│     └─→ Whisper模型 → SRT字幕 + TXT文本                     │
│         ├─ 智能模型选择 (tiny/base/small/medium/large)      │
│         └─ 支持GPU加速                                       │
│         ✅ 检查点: transcribe_completed                      │
│                                                             │
│  3️⃣ AI内容分析                                              │
│     └─→ GPT-4分析转录文本                                    │
│         ├─ 生成内容摘要                                      │
│         └─ 提取关键要点（带时间戳）                           │
│                                                             │
│  4️⃣ 生成简报                                                │
│     └─→ 交互式HTML页面                                       │
│         ├─ 嵌入YouTube播放器                                 │
│         ├─ 可点击的字幕同步                                  │
│         └─ 关键要点时间戳跳转                                │
│         ✅ 检查点: report_completed                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 检查点系统

处理过程支持断点恢复，每个阶段完成后会保存检查点：
- 如果处理中断，重新提交同一链接会从上次中断的位置继续
- 可以单独删除某个阶段的文件，系统会自动检测并重新处理

## 使用说明

1. 在主页输入YouTube视频链接
2. 系统自动下载音频并转换为文字
3. AI分析内容并提取关键要点
4. 生成交互式HTML简报
5. 在简报中：
   - 点击关键要点的时间戳跳转播放
   - 点击右侧字幕任意行跳转到对应位置
   - 播放时字幕自动同步高亮

## 技术栈

- **后端**: Flask, SQLite
- **音频下载**: yt-dlp
- **语音识别**: OpenAI Whisper
- **AI分析**: OpenAI GPT-4
- **前端**: HTML/CSS/JavaScript, YouTube IFrame API

## 注意事项

- 需要配置OpenAI API密钥
- 首次运行会下载Whisper模型
- 处理时间取决于视频长度和网络速度
- 支持断点恢复，处理中断后可从上次位置继续